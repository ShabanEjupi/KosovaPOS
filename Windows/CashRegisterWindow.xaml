<Window x:Class="KosovaPOS.Windows.CashRegisterWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="{DynamicResource CashRegister}" 
        Height="900" Width="1400"
        WindowState="Maximized"
        WindowStartupLocation="CenterScreen"
        KeyDown="Window_KeyDown">
    
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Header -->
        <Border Grid.Row="0" Background="#2196F3" Padding="15">
            <StackPanel>
                <TextBlock x:Name="BusinessNameText" Text="EMRI I BIZNESIT" 
                           FontSize="24" FontWeight="Bold" 
                           Foreground="White" HorizontalAlignment="Center"/>
                
                <!-- Product Search Bar -->
                <Grid Margin="0,15,0,0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <TextBox x:Name="BarcodeSearchBox" 
                             Grid.Column="0"
                             Height="40" 
                             FontSize="18" 
                             VerticalContentAlignment="Center"
                             Padding="10,0"
                             PreviewKeyDown="BarcodeSearchBox_KeyDown"
                             TextChanged="BarcodeSearchBox_TextChanged"
                             GotFocus="BarcodeSearchBox_GotFocus"
                             LostFocus="BarcodeSearchBox_LostFocus">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Background" Value="White"/>
                                <Setter Property="Foreground" Value="Black"/>
                                <Setter Property="BorderBrush" Value="#CCCCCC"/>
                                <Setter Property="BorderThickness" Value="2"/>
                                <Setter Property="CaretBrush" Value="Black"/>
                                <Style.Triggers>
                                    <Trigger Property="IsFocused" Value="True">
                                        <Setter Property="BorderBrush" Value="#4CAF50"/>
                                        <Setter Property="BorderThickness" Value="3"/>
                                        <Setter Property="Background" Value="#FFFFFFE6"/>
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </TextBox.Style>
                    </TextBox>
                    <TextBlock Grid.Column="0" 
                               Text="ðŸ” KÃ«rko produktin (barkodi ose emri)..." 
                               FontSize="16"
                               Foreground="#999999"
                               Margin="15,0,0,0"
                               VerticalAlignment="Center"
                               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>
                                            <Condition Binding="{Binding Text, ElementName=BarcodeSearchBox}" Value=""/>
                                            <Condition Binding="{Binding IsFocused, ElementName=BarcodeSearchBox}" Value="False"/>
                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </MultiDataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button x:Name="SearchButton" 
                            Grid.Column="1"
                            Content="KÃ‹RKO" 
                            Width="100" 
                            Height="40"
                            Margin="10,0,0,0"
                            Background="#4CAF50" 
                            Foreground="White"
                            FontWeight="Bold"
                            FontSize="14"
                            Cursor="Hand"
                            Click="SearchButton_Click"/>
                </Grid>
                
                <!-- Search Results Popup -->
                <Popup x:Name="SearchResultsPopup" 
                       PlacementTarget="{Binding ElementName=BarcodeSearchBox}"
                       Placement="Bottom"
                       AllowsTransparency="True"
                       StaysOpen="False"
                       MaxHeight="300">
                    <Border Background="White" 
                            BorderBrush="#2196F3" 
                            BorderThickness="2"
                            CornerRadius="5">
                        <ListBox x:Name="SearchResultsListBox"
                                 MaxHeight="300"
                                 MinWidth="600"
                                 SelectionChanged="SearchResultsListBox_SelectionChanged"
                                 MouseDoubleClick="SearchResultsListBox_DoubleClick">
                            <ListBox.ItemTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" Margin="5">
                                        <TextBlock Text="{Binding Barcode}" FontWeight="Bold" Width="120"/>
                                        <TextBlock Text="{Binding Name}" Width="300" Margin="10,0"/>
                                        <TextBlock Text="{Binding SalesPrice, StringFormat='{}{0:F2} EUR'}" 
                                                   Foreground="#4CAF50" FontWeight="Bold" Width="100"/>
                                    </StackPanel>
                                </DataTemplate>
                            </ListBox.ItemTemplate>
                        </ListBox>
                    </Border>
                </Popup>
            </StackPanel>
        </Border>
        
        <!-- Customer and Payment Info -->
        <Grid Grid.Row="1" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Buyer Info -->
            <StackPanel Grid.Column="0" Margin="0,0,10,0">
                <TextBlock Text="{DynamicResource BuyerName}" FontWeight="Bold" Margin="0,0,0,5"/>
                <TextBox x:Name="BuyerNameTextBox" Text="Qytetar" Height="35" FontSize="14"/>
                
                <TextBlock Text="{DynamicResource Remark}" FontWeight="Bold" Margin="0,10,0,5"/>
                <TextBox x:Name="RemarkTextBox" Height="60" TextWrapping="Wrap" AcceptsReturn="True"/>
            </StackPanel>
            
            <!-- Payment Panel -->
            <Border Grid.Column="1" BorderBrush="#2196F3" BorderThickness="2" Padding="10" Margin="10,0">
                <StackPanel>
                    <TextBlock Text="{DynamicResource Payment}" FontSize="16" FontWeight="Bold" 
                               HorizontalAlignment="Center" Margin="0,0,0,10"/>
                    
                    <!-- Payment Method Selection (F7 Cash / F8 Card) -->
                    <TextBlock Text="MÃ«nyra e pagesÃ«s (F7/F8)" FontWeight="Bold" Margin="0,0,0,5"/>
                    <Grid Margin="0,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <RadioButton x:Name="CashPaymentRadio" Content="ðŸ’µ Para" Grid.Column="0" 
                                   IsChecked="True" GroupName="PaymentMethod" 
                                   FontSize="14" FontWeight="Bold" 
                                   Checked="PaymentMethodChanged"
                                   VerticalContentAlignment="Center" Padding="5"/>
                        <RadioButton x:Name="CardPaymentRadio" Content="ðŸ’³ KartÃ«" Grid.Column="1" 
                                   GroupName="PaymentMethod" 
                                   FontSize="14" FontWeight="Bold"
                                   Checked="PaymentMethodChanged"
                                   VerticalContentAlignment="Center" Padding="5"/>
                    </Grid>
                    
                    <TextBlock Text="{DynamicResource Paid}" FontWeight="Bold"/>
                    <TextBox x:Name="PaidAmountTextBox" Height="35" FontSize="16" 
                             TextAlignment="Right" Text="0.00"
                             TextChanged="PaidAmountTextBox_TextChanged"/>
                    
                    <!-- Receipt Type Selection (F9/F10/F11) -->
                    <TextBlock Text="Lloji i FaturÃ«s (F9/F10/F11)" FontWeight="Bold" Margin="0,10,0,5"/>
                    <StackPanel Margin="0,0,0,10">
                        <RadioButton x:Name="FiscalReceiptRadio" Content="ðŸ§¾ Fiskale" 
                                   IsChecked="True" GroupName="ReceiptType" 
                                   FontSize="13" Padding="5" Margin="0,2"/>
                        <RadioButton x:Name="SimpleReceiptRadio" Content="ðŸ“„ E thjeshtÃ«" 
                                   GroupName="ReceiptType" 
                                   FontSize="13" Padding="5" Margin="0,2"/>
                        <RadioButton x:Name="WaybillReceiptRadio" Content="ðŸ“‹ FletÃ«hyrje" 
                                   GroupName="ReceiptType" 
                                   FontSize="13" Padding="5" Margin="0,2"/>
                    </StackPanel>
                    
                    <TextBlock Text="{DynamicResource Left}" FontWeight="Bold" Margin="0,5,0,0"/>
                    <TextBox x:Name="LeftAmountTextBox" Height="35" FontSize="16" FontWeight="Bold"
                             TextAlignment="Right" Text="0.00" IsReadOnly="True" 
                             Background="#FFEB3B" Foreground="Red"/>
                </StackPanel>
            </Border>
            
            <!-- Cashier Info -->
            <Border Grid.Column="2" Width="150" BorderBrush="#4CAF50" BorderThickness="2" Padding="10">
                <StackPanel>
                    <TextBlock x:Name="CashierNumberText" Text="01" FontSize="32" FontWeight="Bold" 
                               HorizontalAlignment="Center" Foreground="#4CAF50"/>
                    <TextBlock x:Name="CashierNameText" Text="ArkÃ«tari" 
                               HorizontalAlignment="Center" TextWrapping="Wrap" TextAlignment="Center"/>
                </StackPanel>
            </Border>
        </Grid>
        
        <!-- Receipt Items Grid -->
        <DataGrid x:Name="ReceiptItemsDataGrid" Grid.Row="2" 
                  Style="{StaticResource POSDataGrid}"
                  Margin="10"
                  AutoGenerateColumns="False"
                  SelectionChanged="ReceiptItemsDataGrid_SelectionChanged"
                  CellEditEnding="ReceiptItemsDataGrid_CellEditEnding">
            <DataGrid.Columns>
                <DataGridTextColumn Header="{DynamicResource Barcode}" Binding="{Binding Barcode}" Width="120" IsReadOnly="True"/>
                <DataGridTextColumn Header="{DynamicResource ArticleName}" Binding="{Binding ArticleName}" Width="2*" IsReadOnly="True"/>
                <DataGridTextColumn Header="{DynamicResource Quantity}" Binding="{Binding Quantity, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" Width="100" />
                <DataGridTextColumn Header="{DynamicResource Price}" Binding="{Binding Price, StringFormat=F2}" Width="100" IsReadOnly="True"/>
                <DataGridTextColumn Header="{DynamicResource Discount}" Binding="{Binding DiscountPercent, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" Width="100"/>
                <DataGridTextColumn Header="{DynamicResource VAT}" Binding="{Binding VATRate, StringFormat=F0}" Width="80" IsReadOnly="True"/>
                <DataGridTextColumn Header="{DynamicResource DiscountValue}" Binding="{Binding DiscountValue, StringFormat=F2, UpdateSourceTrigger=PropertyChanged}" Width="120"/>
                <DataGridTextColumn Header="{DynamicResource Value}" Binding="{Binding TotalValue, StringFormat=F2}" Width="120" IsReadOnly="True"/>
            </DataGrid.Columns>
        </DataGrid>
        
        <!-- Bottom Panel -->
        <Grid Grid.Row="3" Margin="10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            
            <!-- Function Buttons and Fiscal Reports -->
            <StackPanel Grid.Column="0">
                <!-- Function Buttons Row 1 -->
                <WrapPanel Margin="0,0,0,10">
                    <Button x:Name="PrintReceiptButton" Content="{DynamicResource PrintReceipt}" 
                            Style="{StaticResource FunctionButton}" Width="150"
                            Background="#4CAF50" Foreground="White"
                            Click="PrintReceiptButton_Click"/>
                    <Button x:Name="CopyButton" Content="{DynamicResource Copy}" 
                            Style="{StaticResource FunctionButton}" Width="150"
                            Background="#2196F3" Foreground="White"
                            Click="CopyButton_Click"/>
                </WrapPanel>
                
                <!-- Function Buttons Row 2 -->
                <WrapPanel Margin="0,0,0,10">
                    <Button x:Name="ApplyDiscountButton" Content="Zbritje / Discount" 
                            Style="{StaticResource FunctionButton}" Width="150"
                            Background="#9C27B0" Foreground="White"
                            Click="ApplyDiscountButton_Click"/>
                    <Button x:Name="ClearRowButton" Content="{DynamicResource ClearRow}" 
                            Style="{StaticResource FunctionButton}" Width="150"
                            Background="#FF9800" Foreground="White"
                            Click="ClearRowButton_Click"/>
                    <Button x:Name="DiscardReceiptButton" Content="{DynamicResource DiscardReceipt}" 
                            Style="{StaticResource FunctionButton}" Width="150"
                            Background="#F44336" Foreground="White"
                            Click="DiscardReceiptButton_Click"/>
                </WrapPanel>
                
                <!-- Fiscal Reports -->
                <Expander Header="{DynamicResource FiscalReports}" IsExpanded="False" Margin="0,10,0,0">
                    <WrapPanel>
                        <Button x:Name="ZReportButton" Content="{DynamicResource ZReport}" 
                                Style="{StaticResource FunctionButton}" Width="200"
                                Click="ZReportButton_Click"/>
                        <Button x:Name="XReportButton" Content="{DynamicResource XReport}" 
                                Style="{StaticResource FunctionButton}" Width="200"
                                Click="XReportButton_Click"/>
                        <Button x:Name="SoldArticlesButton" Content="{DynamicResource SoldArticles}" 
                                Style="{StaticResource FunctionButton}" Width="200"
                                Click="SoldArticlesButton_Click"/>
                    </WrapPanel>
                </Expander>
                
                <!-- Tax Display -->
                <TextBlock x:Name="TaxDisplayText" Text="T: 0.00" FontSize="18" FontWeight="Bold" 
                           Margin="0,20,0,0" Foreground="#E91E63"/>
            </StackPanel>
            
            <!-- Total Display -->
            <Border Grid.Column="1" Width="300" BorderBrush="#4CAF50" BorderThickness="3" 
                    Background="#C8E6C9" Padding="20">
                <StackPanel>
                    <TextBlock Text="TOTALI" FontSize="24" FontWeight="Bold" 
                               HorizontalAlignment="Center" Foreground="#1B5E20"/>
                    <TextBlock x:Name="TotalDisplayText" Text="0.00" FontSize="48" FontWeight="Bold" 
                               HorizontalAlignment="Center" Foreground="#1B5E20"/>
                    <TextBlock Text="EUR" FontSize="18" 
                               HorizontalAlignment="Center" Foreground="#1B5E20"/>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Window>
